# Camer4pdf 개발 작업 보고서

**작성일**: 2025년 11월 28일  
**프로젝트**: Camer4pdf - 카메라 촬영 및 PDF 변환 iOS 앱

---

## 목차
1. [프로젝트 개요](#프로젝트-개요)
2. [작업 내용](#작업-내용)
3. [구현된 기능](#구현된-기능)
4. [기술적 이슈 및 해결](#기술적-이슈-및-해결)
5. [파일 구조](#파일-구조)
6. [사용 방법](#사용-방법)

---

## 프로젝트 개요

### 앱 정보
- **앱 이름**: Camer4pdf
- **플랫폼**: iOS 18.5+
- **개발 언어**: Swift, SwiftUI
- **주요 기능**: 카메라 촬영, 이미지 저장, PDF 변환

### 앱 목적
사용자가 카메라로 촬영한 사진을 즉시 갤러리에 저장하거나 PDF 파일로 변환하여 파일 앱에 저장할 수 있는 iOS 애플리케이션

---

## 작업 내용

### 1. SwiftUI Preview 문제 해결

#### 문제
- Xcode Canvas에서 Preview가 표시되지 않음
- 실제 카메라 세션을 Preview 환경에서 시작할 수 없어 발생

#### 해결 방법
`CameraManager`에 Preview 모드를 추가하여 Preview 환경에서는 실제 카메라 세션 없이 UI만 렌더링

```swift
// Preview용 초기화 메서드 추가
init(isPreview: Bool) {
    self.isPreviewMode = isPreview
    super.init()
    if isPreview {
        isAuthorized = true
    } else {
        checkAuthorization()
    }
}
```

**수정 파일**:
- `Camer4pdf/CameraManager.swift`
- `Camer4pdf/ContentView.swift` - Preview 구성 추가
- `Camer4pdf/CameraView.swift` - Preview 추가

---

### 2. 빌드 오류 해결 (Schema Build Failure)

#### 문제
```
Failed to build the schema "Camer4pdf"
```

#### 원인
- 프로젝트 설정: `GENERATE_INFOPLIST_FILE = YES`
- 실제 파일: `Info.plist` 수동 생성
- 두 가지가 충돌하여 빌드 실패

#### 해결 방법

**1) 수동 Info.plist 파일 삭제**
```bash
Camer4pdf/Info.plist 삭제
```

**2) project.pbxproj에 권한 설정 추가**
```
INFOPLIST_KEY_NSCameraUsageDescription = "사진을 촬영하기 위해 카메라 접근 권한이 필요합니다.";
INFOPLIST_KEY_NSPhotoLibraryAddUsageDescription = "촬영한 사진을 저장하기 위해 사진 라이브러리 접근 권한이 필요합니다.";
```

**수정 파일**:
- `Camer4pdf.xcodeproj/project.pbxproj`
- `Camer4pdf/Info.plist` (삭제)

---

### 3. PDF 내보내기 기능 구현

#### 새로운 파일 생성: PDFGenerator.swift

이미지를 PDF로 변환하는 유틸리티 클래스 구현

**주요 기능**:
- 단일 이미지를 PDF Data로 변환
- 이미지 크기에 맞는 PDF 페이지 생성
- 여러 이미지를 하나의 PDF로 변환 (향후 확장 기능)

```swift
class PDFGenerator {
    static func createPDFData(from image: UIImage) -> Data? {
        let format = UIGraphicsPDFRendererFormat()
        let pageRect = CGRect(x: 0, y: 0, width: image.size.width, height: image.size.height)
        let renderer = UIGraphicsPDFRenderer(bounds: pageRect, format: format)
        
        let data = renderer.pdfData { context in
            context.beginPage()
            image.draw(in: pageRect)
        }
        return data
    }
}
```

**수정 파일**:
- `Camer4pdf/PDFGenerator.swift` (신규 생성)
- `Camer4pdf/ContentView.swift` - PDF 버튼 및 기능 추가

---

### 4. 이미지 저장 알림 개선

#### 문제
- 저장 버튼을 눌렀을 때 알림이 표시되지 않음
- `UIImageWriteToSavedPhotosAlbum`의 완료 핸들러를 사용하지 않아 실제 저장 완료 여부를 알 수 없음

#### 해결 방법

**ImageSaver 헬퍼 클래스 추가**
```swift
class ImageSaver: NSObject {
    var successHandler: (() -> Void)?
    var errorHandler: ((Error) -> Void)?
    
    func writeToPhotoAlbum(image: UIImage) {
        UIImageWriteToSavedPhotosAlbum(image, self, #selector(saveCompleted), nil)
    }
    
    @objc func saveCompleted(_ image: UIImage, didFinishSavingWithError error: Error?, contextInfo: UnsafeRawPointer) {
        if let error = error {
            errorHandler?(error)
        } else {
            successHandler?()
        }
    }
}
```

**결과**:
- ✅ 저장 성공 시: "사진이 갤러리에 저장되었습니다." 알림 표시
- ✅ 저장 실패 시: 오류 메시지와 함께 실패 이유 표시

**수정 파일**:
- `Camer4pdf/ContentView.swift` - ImageSaver 클래스 추가

---

### 5. PDF 저장 방식 개선

#### 문제
- PDF 버튼 클릭 시 하얀 화면(공유 시트)이 나타남
- 사용자 경험이 저장 버튼과 일관되지 않음

#### 해결 방법

**공유 시트 제거 및 직접 저장**
```swift
private func exportToPDF() {
    guard let pdfData = PDFGenerator.createPDFData(from: image) else {
        alertMessage = "PDF 생성에 실패했습니다."
        showAlert = true
        return
    }
    
    let fileName = "Photo_\(Date().timeIntervalSince1970).pdf"
    if let documentsPath = FileManager.default.urls(for: .documentDirectory, in: .userDomainMask).first {
        let fileURL = documentsPath.appendingPathComponent(fileName)
        try pdfData.write(to: fileURL)
        alertMessage = "PDF가 파일 앱에 저장되었습니다.\n파일명: \(fileName)"
        showAlert = true
    }
}
```

**파일 공유 설정 추가**
```
INFOPLIST_KEY_UIFileSharingEnabled = YES
INFOPLIST_KEY_LSSupportsOpeningDocumentsInPlace = YES
```

**결과**:
- PDF가 앱의 Documents 폴더에 직접 저장
- 저장 완료 후 알림 다이얼로그 표시
- 파일 앱에서 PDF 접근 가능

**수정 파일**:
- `Camer4pdf/ContentView.swift` - PDF 저장 로직 수정
- `Camer4pdf/PDFGenerator.swift` - createPDFData 메서드 추가
- `Camer4pdf.xcodeproj/project.pbxproj` - 파일 공유 설정 추가

---

## 구현된 기능

### 1. 카메라 촬영
- ✅ 전면/후면 카메라 전환
- ✅ 실시간 카메라 프리뷰
- ✅ 사진 촬영
- ✅ 카메라 권한 관리

### 2. 이미지 저장
- ✅ 갤러리에 이미지 저장
- ✅ 저장 성공/실패 알림
- ✅ 사진 라이브러리 권한 관리

### 3. PDF 변환 및 저장
- ✅ 촬영한 이미지를 PDF로 변환
- ✅ PDF 파일을 Documents 폴더에 저장
- ✅ 저장 완료 알림 (파일명 포함)
- ✅ 파일 앱에서 PDF 접근 가능

### 4. UI/UX
- ✅ 깔끔한 카메라 인터페이스
- ✅ 이미지 미리보기 화면
- ✅ 일관된 알림 다이얼로그
- ✅ 직관적인 버튼 아이콘 및 레이블

---

## 기술적 이슈 및 해결

| 이슈 | 원인 | 해결 방법 |
|------|------|-----------|
| Preview 미표시 | 카메라 세션을 Preview에서 시작할 수 없음 | Preview 모드 추가로 UI만 렌더링 |
| 빌드 실패 | Info.plist 자동생성과 수동파일 충돌 | 수동 파일 삭제, 프로젝트 설정에 키 추가 |
| 저장 알림 미표시 | 완료 핸들러 미사용 | ImageSaver 클래스로 완료 감지 |
| PDF 공유 시트 표시 | ShareSheet 사용 | 직접 저장 방식으로 변경 |

---

## 파일 구조

```
Camer4pdf/
├── Camer4pdf/
│   ├── Camer4pdfApp.swift          # 앱 진입점
│   ├── ContentView.swift            # 메인 뷰 및 이미지 프리뷰
│   ├── CameraView.swift             # 카메라 프리뷰 UIViewRepresentable
│   ├── CameraManager.swift          # 카메라 세션 관리
│   ├── PDFGenerator.swift           # PDF 생성 유틸리티
│   ├── Camer4pdf-Bridging-Header.h  # Objective-C 브리징 헤더
│   └── Assets.xcassets/             # 이미지 에셋
├── Camer4pdf.xcodeproj/
│   └── project.pbxproj              # 프로젝트 설정
└── Report/
    └── 개발_작업_보고서.md          # 본 문서
```

---

## 사용 방법

### 앱 실행 및 촬영

1. **앱 실행**
   - 카메라 권한 요청 시 "허용" 선택

2. **사진 촬영**
   - 화면 하단 가운데 흰색 원형 버튼 탭
   - 자동으로 미리보기 화면 표시

3. **미리보기 화면에서 선택**
   - **저장 버튼** (화살표 아이콘): 갤러리에 이미지 저장
   - **PDF 버튼** (문서 아이콘): PDF 파일로 변환하여 저장
   - **확인 버튼** (체크 아이콘): 미리보기 닫기

### PDF 파일 확인

1. **파일 앱** 실행
2. **내 iPhone** (또는 **내 iPad**) 선택
3. **Camer4pdf** 폴더 열기
4. PDF 파일 확인 및 공유/전송 가능

### 추가 기능

- **카메라 전환**: 좌측 하단 회전 아이콘으로 전면/후면 카메라 전환
- **갤러리**: 우측 하단 썸네일로 마지막 촬영 사진 확인

---

## 개발 환경

- **Xcode**: 16.4
- **Swift**: 5.0
- **최소 지원 버전**: iOS 18.5
- **타겟 디바이스**: iPhone, iPad

---

## 권한 설정

앱이 요구하는 권한:

| 권한 | 용도 | 설명 |
|------|------|------|
| NSCameraUsageDescription | 카메라 접근 | "사진을 촬영하기 위해 카메라 접근 권한이 필요합니다." |
| NSPhotoLibraryAddUsageDescription | 사진 저장 | "촬영한 사진을 저장하기 위해 사진 라이브러리 접근 권한이 필요합니다." |
| UIFileSharingEnabled | 파일 공유 | 파일 앱을 통한 PDF 접근 허용 |
| LSSupportsOpeningDocumentsInPlace | 문서 접근 | 파일 앱에서 직접 문서 열기 지원 |

---

## 향후 개선 사항

### 단기 개선 (High Priority)
- [ ] 여러 이미지를 하나의 PDF로 결합
- [ ] PDF 파일명 커스터마이징 옵션
- [ ] 이미지 편집 기능 (회전, 크롭)
- [ ] 플래시 제어 기능

### 중기 개선 (Medium Priority)
- [ ] OCR (광학 문자 인식) 기능
- [ ] PDF에 텍스트/주석 추가
- [ ] 클라우드 저장 (iCloud Drive, Google Drive)
- [ ] 다크 모드 최적화

### 장기 개선 (Low Priority)
- [ ] 문서 자동 가장자리 감지
- [ ] 배치 스캔 모드
- [ ] PDF 암호화
- [ ] Apple Watch 지원

---

## 주요 코드 스니펫

### 1. CameraManager 초기화

```swift
class CameraManager: NSObject, ObservableObject {
    @Published var capturedImage: UIImage?
    @Published var isAuthorized = false
    
    private var isPreviewMode = false
    
    // Preview용 초기화
    init(isPreview: Bool) {
        self.isPreviewMode = isPreview
        super.init()
        if isPreview {
            isAuthorized = true
        } else {
            checkAuthorization()
        }
    }
}
```

### 2. PDF 생성

```swift
static func createPDFData(from image: UIImage) -> Data? {
    let format = UIGraphicsPDFRendererFormat()
    let pageRect = CGRect(x: 0, y: 0, width: image.size.width, height: image.size.height)
    let renderer = UIGraphicsPDFRenderer(bounds: pageRect, format: format)
    
    return renderer.pdfData { context in
        context.beginPage()
        image.draw(in: pageRect)
    }
}
```

### 3. 이미지 저장 완료 처리

```swift
class ImageSaver: NSObject {
    var successHandler: (() -> Void)?
    var errorHandler: ((Error) -> Void)?
    
    @objc func saveCompleted(_ image: UIImage, didFinishSavingWithError error: Error?, contextInfo: UnsafeRawPointer) {
        if let error = error {
            errorHandler?(error)
        } else {
            successHandler?()
        }
    }
}
```

---

## 버전 히스토리

### v1.0.0 (2025-11-28)
- ✅ 기본 카메라 촬영 기능
- ✅ 이미지 갤러리 저장
- ✅ PDF 변환 및 저장
- ✅ 전면/후면 카메라 전환
- ✅ 미리보기 화면
- ✅ 파일 앱 통합

---

## 결론

Camer4pdf 앱은 기본적인 카메라 촬영 기능과 함께 이미지를 PDF로 변환하는 핵심 기능을 성공적으로 구현했습니다. 

**주요 성과**:
1. ✅ SwiftUI와 AVFoundation을 활용한 카메라 기능 구현
2. ✅ UIKit과 SwiftUI의 효과적인 통합 (UIViewRepresentable)
3. ✅ PDF 생성 및 파일 시스템 관리
4. ✅ 일관된 UX를 위한 알림 처리
5. ✅ 파일 앱 통합으로 사용자 접근성 향상

앱은 안정적으로 작동하며, 향후 OCR, 다중 이미지 결합 등의 고급 기능을 추가하여 더욱 강력한 문서 스캔 앱으로 발전시킬 수 있습니다.

---

**문서 작성자**: AI Assistant  
**최종 수정일**: 2025년 11월 28일  
**버전**: 1.0


